{"ast":null,"code":"import _slicedToArray from \"/Users/elijahchen/blockchain-developer-bootcamp/blockchain-developer-bootcamp-final-project/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/elijahchen/blockchain-developer-bootcamp/blockchain-developer-bootcamp-final-project/client/src/App.js\";\nimport React, { Component } from \"react\";\nimport { useEffect, useState } from \"react\";\nimport CarSharingContract from \"./contracts/CarSharing.json\";\nimport getWeb3 from \"./getWeb3\";\nimport \"./App.css\";\n\nconst HelloWorld = () => {\n  //state variables\n  const _useState = useState(\"\"),\n        _useState2 = _slicedToArray(_useState, 2),\n        walletAddress = _useState2[0],\n        setWallet = _useState2[1];\n\n  const _useState3 = useState(\"\"),\n        _useState4 = _slicedToArray(_useState3, 2),\n        status = _useState4[0],\n        setStatus = _useState4[1];\n\n  const _useState5 = useState(\"No connection to the network.\"),\n        _useState6 = _slicedToArray(_useState5, 2),\n        message = _useState6[0],\n        setMessage = _useState6[1]; //default message\n\n\n  const _useState7 = useState(\"\"),\n        _useState8 = _slicedToArray(_useState7, 2),\n        newMessage = _useState8[0],\n        setNewMessage = _useState8[1];\n\n  const carContract = useState(\"\");\n\n  const componentDidMount = async () => {\n    try {\n      alert(\"ailed to load Fweb3, accounts, or contract. Check console for details.\"); // Get network provider and web3 instance.\n\n      const web3 = await getWeb3(); // Use web3 to get the user's accounts.\n\n      const accounts = await web3.eth.getAccounts(); // Get the contract instance.\n      // const networkId = await web3.eth.net.getId();\n      // const deployedNetwork = SimpleStorageContract.networks[networkId];\n      // const instance = new web3.eth.Contract(\n      //   SimpleStorageContract.abi,\n      //   deployedNetwork && deployedNetwork.address,\n      // );\n\n      const networkId = await web3.eth.net.getId();\n      const deployedNetwork = CarSharingContract.networks[networkId];\n      const instance = new web3.eth.Contract(CarSharingContract.abi, deployedNetwork && deployedNetwork.address);\n      instance.events.UserRegistered({}, (error, data) => {\n        if (error) {\n          setStatus(\"😥 \" + error.message);\n        } else {\n          setMessage(data.returnValues[1]);\n          setNewMessage(\"\");\n          setStatus(\"🎉 Your message has been updated!\");\n        }\n      });\n\n      const _ref = await getCurrentWalletConnected(),\n            address = _ref.address,\n            status = _ref.status;\n\n      setWallet(address);\n      setStatus(status);\n      addWalletListener(); // Set web3, accounts, and contract to the state, and then proceed with an\n      // example of interacting with the contract's methods.\n      //this.setState({ web3, accounts, contract: instance }, this.startApp);\n    } catch (error) {\n      // Catch any errors for any of the above operations.\n      alert(\"Failed to load web3, accounts, or contract. Check console for details.\");\n      console.error(error);\n    }\n  };\n  /* //called only once\n  useEffect(async () => {\n    const web3 = await getWeb3();\n    const contractABI = CarSharingContract;\n    const contractAddress = \"0xb7B7459DAF2B61bBb32Ba5Ab8dDfF858cd7B5332\";\n    carContract = new web3.eth.Contract(\n      contractABI,\n      contractAddress\n    );\n     // const message = await getRegistrationStatus();\n    // setMessage(message);\n    addSmartContractListener();\n     const { address, status } = await getCurrentWalletConnected();\n     setWallet(address);\n    setStatus(status);\n     addWalletListener();\n  }, []); */\n\n\n  function addSmartContractListener() {\n    carContract.events.Received({}, (error, data) => {\n      if (error) {\n        setStatus(\"😥 \" + error.message);\n      } else {\n        setMessage(data.returnValues[1]);\n        setNewMessage(\"\");\n        setStatus(\"🎉 Your message has been updated!\");\n      }\n    });\n  }\n\n  function addWalletListener() {\n    if (window.ethereum) {\n      window.ethereum.on(\"accountsChanged\", accounts => {\n        if (accounts.length > 0) {\n          setWallet(accounts[0]);\n          setStatus(\"👆🏽 Write a message in the text-field above.\");\n        } else {\n          setWallet(\"\");\n          setStatus(\"🦊 Connect to Metamask using the top right button.\");\n        }\n      });\n    } else {\n      setStatus(React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 118\n        },\n        __self: this\n      }, \" \", \"\\uD83E\\uDD8A\", \" \", React.createElement(\"a\", {\n        target: \"_blank\",\n        href: \"https://metamask.io/download.html\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 121\n        },\n        __self: this\n      }, \"You must install Metamask, a virtual Ethereum wallet, in your browser.\")));\n    }\n  }\n\n  const connectWalletPressed = async () => {\n    const walletResponse = await connectWallet();\n    setStatus(walletResponse.status);\n    setWallet(walletResponse.address);\n  }; // interactions\n\n\n  const loadRegistrationStatus = async () => {\n    const status = await CarSharingContract.methods.getRegistrationStatus(walletAddress).call();\n    return status;\n  };\n\n  const registerUser = async () => {\n    await CarSharingContract.methods.registerDriver(this.state.userName, this.state.userId).send({\n      from: walletAddress\n    });\n    let response = await CarSharingContract.methods.getRegistrationStatus(walletAddress).call();\n\n    if (response == true) {\n      this.setState({\n        registrationStatus: \"You are registered\"\n      });\n    }\n  };\n\n  const connectWallet = async () => {\n    if (window.ethereum) {\n      try {\n        const addressArray = await window.ethereum.request({\n          method: \"eth_requestAccounts\"\n        });\n        const obj = {\n          status: \"👆🏽 Write a message in the text-field above.\",\n          address: addressArray[0]\n        };\n        return obj;\n      } catch (err) {\n        return {\n          address: \"\",\n          status: \"😥 \" + err.message\n        };\n      }\n    } else {\n      return {\n        address: \"\",\n        status: React.createElement(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 176\n          },\n          __self: this\n        }, React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 177\n          },\n          __self: this\n        }, \" \", \"\\uD83E\\uDD8A\", \" \", React.createElement(\"a\", {\n          target: \"_blank\",\n          href: \"https://metamask.io/download.html\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 180\n          },\n          __self: this\n        }, \"You must install Metamask, a virtual Ethereum wallet, in your browser.\")))\n      };\n    }\n  };\n\n  const getCurrentWalletConnected = async () => {\n    if (window.ethereum) {\n      try {\n        const addressArray = await window.ethereum.request({\n          method: \"eth_accounts\"\n        });\n\n        if (addressArray.length > 0) {\n          return {\n            address: addressArray[0],\n            status: \"👆🏽 Write a message in the text-field above.\"\n          };\n        } else {\n          return {\n            address: \"\",\n            status: \"🦊 Connect to Metamask using the top right button.\"\n          };\n        }\n      } catch (err) {\n        return {\n          address: \"\",\n          status: \"😥 \" + err.message\n        };\n      }\n    } else {\n      return {\n        address: \"\",\n        status: React.createElement(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 218\n          },\n          __self: this\n        }, React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 219\n          },\n          __self: this\n        }, \" \", \"\\uD83E\\uDD8A\", \" \", React.createElement(\"a\", {\n          target: \"_blank\",\n          href: \"https://metamask.io/download.html\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 222\n          },\n          __self: this\n        }, \"You must install Metamask, a virtual Ethereum wallet, in your browser.\")))\n      };\n    }\n  }; // ------------------------------\n  //the UI of our component\n\n\n  return React.createElement(\"div\", {\n    id: \"container\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    id: \"walletButton\",\n    onClick: connectWalletPressed,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 240\n    },\n    __self: this\n  }, walletAddress.length > 0 ? \"Connected: \" + String(walletAddress).substring(0, 6) + \"...\" + String(walletAddress).substring(38) : React.createElement(\"span\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247\n    },\n    __self: this\n  }, \"Connect Wallet\")), React.createElement(\"h2\", {\n    style: {\n      paddingTop: \"50px\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 251\n    },\n    __self: this\n  }, \"Current Message:\"), React.createElement(\"p\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 252\n    },\n    __self: this\n  }, message), React.createElement(\"h2\", {\n    style: {\n      paddingTop: \"18px\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 254\n    },\n    __self: this\n  }, \"New Message:\"), React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 256\n    },\n    __self: this\n  }, React.createElement(\"input\", {\n    type: \"text\",\n    placeholder: \"Update the message in your smart contract.\",\n    onChange: e => setNewMessage(e.target.value),\n    value: newMessage,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 257\n    },\n    __self: this\n  }), React.createElement(\"p\", {\n    id: \"status\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 263\n    },\n    __self: this\n  }, status), React.createElement(\"button\", {\n    id: \"publish\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 265\n    },\n    __self: this\n  }, \"Update\")));\n};\n\nexport default HelloWorld;","map":{"version":3,"sources":["/Users/elijahchen/blockchain-developer-bootcamp/blockchain-developer-bootcamp-final-project/client/src/App.js"],"names":["React","Component","useEffect","useState","CarSharingContract","getWeb3","HelloWorld","walletAddress","setWallet","status","setStatus","message","setMessage","newMessage","setNewMessage","carContract","componentDidMount","alert","web3","accounts","eth","getAccounts","networkId","net","getId","deployedNetwork","networks","instance","Contract","abi","address","events","UserRegistered","error","data","returnValues","getCurrentWalletConnected","addWalletListener","console","addSmartContractListener","Received","window","ethereum","on","length","connectWalletPressed","walletResponse","connectWallet","loadRegistrationStatus","methods","getRegistrationStatus","call","registerUser","registerDriver","state","userName","userId","send","from","response","setState","registrationStatus","addressArray","request","method","obj","err","String","substring","paddingTop","e","target","value"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { useEffect, useState } from \"react\";\nimport CarSharingContract from \"./contracts/CarSharing.json\";\nimport getWeb3 from \"./getWeb3\";\n\nimport \"./App.css\";\n\nconst HelloWorld = () => {\n  //state variables\n  const [walletAddress, setWallet] = useState(\"\");\n  const [status, setStatus] = useState(\"\");\n  const [message, setMessage] = useState(\"No connection to the network.\"); //default message\n  const [newMessage, setNewMessage] = useState(\"\");\n  const carContract = useState(\"\");\n\n  const componentDidMount = async () => {\n    try {\n      alert(\n        `ailed to load Fweb3, accounts, or contract. Check console for details.`,\n      );\n      // Get network provider and web3 instance.\n      const web3 = await getWeb3();\n\n      // Use web3 to get the user's accounts.\n      const accounts = await web3.eth.getAccounts();\n\n      // Get the contract instance.\n      // const networkId = await web3.eth.net.getId();\n      // const deployedNetwork = SimpleStorageContract.networks[networkId];\n      // const instance = new web3.eth.Contract(\n      //   SimpleStorageContract.abi,\n      //   deployedNetwork && deployedNetwork.address,\n      // );\n\n      const networkId = await web3.eth.net.getId();\n      const deployedNetwork = CarSharingContract.networks[networkId];\n      const instance = new web3.eth.Contract(\n        CarSharingContract.abi,\n        deployedNetwork && deployedNetwork.address,\n      );\n\n      instance.events.UserRegistered({}, (error, data) => {\n        if (error) {\n          setStatus(\"😥 \" + error.message);\n        } else {\n          setMessage(data.returnValues[1]);\n          setNewMessage(\"\");\n          setStatus(\"🎉 Your message has been updated!\");\n        }\n      });\n\n      const { address, status } = await getCurrentWalletConnected();\n\n      setWallet(address);\n      setStatus(status);\n  \n      addWalletListener();\n      // Set web3, accounts, and contract to the state, and then proceed with an\n      // example of interacting with the contract's methods.\n      //this.setState({ web3, accounts, contract: instance }, this.startApp);\n    } catch (error) {\n      // Catch any errors for any of the above operations.\n      alert(\n        `Failed to load web3, accounts, or contract. Check console for details.`,\n      );\n      console.error(error);\n    }\n  };\n\n\n  /* //called only once\n  useEffect(async () => {\n    const web3 = await getWeb3();\n    const contractABI = CarSharingContract;\n    const contractAddress = \"0xb7B7459DAF2B61bBb32Ba5Ab8dDfF858cd7B5332\";\n    carContract = new web3.eth.Contract(\n      contractABI,\n      contractAddress\n    );\n\n    // const message = await getRegistrationStatus();\n    // setMessage(message);\n    addSmartContractListener();\n\n    const { address, status } = await getCurrentWalletConnected();\n\n    setWallet(address);\n    setStatus(status);\n\n    addWalletListener();\n  }, []); */\n\n  function addSmartContractListener() {\n    carContract.events.Received({}, (error, data) => {\n      if (error) {\n        setStatus(\"😥 \" + error.message);\n      } else {\n        setMessage(data.returnValues[1]);\n        setNewMessage(\"\");\n        setStatus(\"🎉 Your message has been updated!\");\n      }\n    });\n  }\n\n  function addWalletListener() {\n    if (window.ethereum) {\n      window.ethereum.on(\"accountsChanged\", (accounts) => {\n        if (accounts.length > 0) {\n          setWallet(accounts[0]);\n          setStatus(\"👆🏽 Write a message in the text-field above.\");\n        } else {\n          setWallet(\"\");\n          setStatus(\"🦊 Connect to Metamask using the top right button.\");\n        }\n      });\n    } else {\n      setStatus(\n        <p>\n          {\" \"}\n          🦊{\" \"}\n          <a target=\"_blank\" href={`https://metamask.io/download.html`}>\n            You must install Metamask, a virtual Ethereum wallet, in your\n            browser.\n          </a>\n        </p>\n      );\n    }\n  }\n\n  const connectWalletPressed = async () => {\n    const walletResponse = await connectWallet();\n    setStatus(walletResponse.status);\n    setWallet(walletResponse.address);\n  };\n\n\n  // interactions\n\n const loadRegistrationStatus = async () => {\n  const status = await CarSharingContract.methods.getRegistrationStatus(walletAddress).call();\n  return status;\n};\n\n\n const registerUser = async () => {\n  await CarSharingContract.methods.registerDriver(this.state.userName, this.state.userId).send({ from: walletAddress });\n\n  let response = await CarSharingContract.methods.getRegistrationStatus(walletAddress).call();\n  if(response == true){\n    this.setState({ registrationStatus: \"You are registered\"});\n  }\n  \n};\n\n const connectWallet = async () => {\n  if (window.ethereum) {\n    try {\n      const addressArray = await window.ethereum.request({\n        method: \"eth_requestAccounts\",\n      });\n      const obj = {\n        status: \"👆🏽 Write a message in the text-field above.\",\n        address: addressArray[0],\n      };\n      return obj;\n    } catch (err) {\n      return {\n        address: \"\",\n        status: \"😥 \" + err.message,\n      };\n    }\n  } else {\n    return {\n      address: \"\",\n      status: (\n        <span>\n          <p>\n            {\" \"}\n            🦊{\" \"}\n            <a target=\"_blank\" href={`https://metamask.io/download.html`}>\n              You must install Metamask, a virtual Ethereum wallet, in your\n              browser.\n            </a>\n          </p>\n        </span>\n      ),\n    };\n  }\n};\n\n const getCurrentWalletConnected = async () => {\n  if (window.ethereum) {\n    try {\n      const addressArray = await window.ethereum.request({\n        method: \"eth_accounts\",\n      });\n      if (addressArray.length > 0) {\n        return {\n          address: addressArray[0],\n          status: \"👆🏽 Write a message in the text-field above.\",\n        };\n      } else {\n        return {\n          address: \"\",\n          status: \"🦊 Connect to Metamask using the top right button.\",\n        };\n      }\n    } catch (err) {\n      return {\n        address: \"\",\n        status: \"😥 \" + err.message,\n      };\n    }\n  } else {\n    return {\n      address: \"\",\n      status: (\n        <span>\n          <p>\n            {\" \"}\n            🦊{\" \"}\n            <a target=\"_blank\" href={`https://metamask.io/download.html`}>\n              You must install Metamask, a virtual Ethereum wallet, in your\n              browser.\n            </a>\n          </p>\n        </span>\n      ),\n    };\n  }\n};\n\n// ------------------------------\n\n\n  //the UI of our component\n  return (\n    <div id=\"container\">\n      \n      <button id=\"walletButton\" onClick={connectWalletPressed}>\n        {walletAddress.length > 0 ? (\n          \"Connected: \" +\n          String(walletAddress).substring(0, 6) +\n          \"...\" +\n          String(walletAddress).substring(38)\n        ) : (\n          <span>Connect Wallet</span>\n        )}\n      </button>\n\n      <h2 style={{ paddingTop: \"50px\" }}>Current Message:</h2>\n      <p>{message}</p>\n\n      <h2 style={{ paddingTop: \"18px\" }}>New Message:</h2>\n\n      <div>\n        <input\n          type=\"text\"\n          placeholder=\"Update the message in your smart contract.\"\n          onChange={(e) => setNewMessage(e.target.value)}\n          value={newMessage}\n        />\n        <p id=\"status\">{status}</p>\n\n        <button id=\"publish\">\n          Update\n        </button>\n      </div>\n    </div>\n  );\n};\n\n\n\nexport default HelloWorld;"]},"metadata":{},"sourceType":"module"}